ORF discovery tools
==========

Glossary of terms
----------
http://plastid.readthedocs.org/en/latest/glossary.html

ORF-RATER
----------
https://github.com/alexfields/ORF-RATER

Key:
1. The algorithm is tuned to indicate the highest-confidence sites of translation

2. Bona fide translation at unannotated CDSs should show density patterns of RPFs
   similar to those of annotated CDSs

3. If two or more overlapping ORFs are translated, the final read density would be 
   expected to be the sum of the read densities of each independent ORF. Therefore,
   linear regression is a natural tool to evaluate the contribution of each possible
   ORF to the observed read densities

Limitations:
It is likely to miss sites of non-canonical translation in which the RPF pattern does
not match that at canonical CDSs, e.g. pause sequences, programmed frameshifts, or 
stop codon read-through.

Input:
Reference transcriptomes (NOT whole genome), previously assembled (which we don't have but can 
assemble by Cufflinks) + RefSeq + ENSEMBL transcripts bams (tophat aligned)

Output: A score for an ORF

/////////////////////////
Dependency:

* plastid package

Performing metagene analyses - https://plastid.readthedocs.org/en/latest/examples/metagene.html

A metagene average is computed by:
1. Fetching vectors of quantitative data – in this example, ribosome-protected 
footprints – surrounding each occurrence of the feature of interset – in this 
case, a start codon – in each region

2. Normalizing each vector to the same scale by dividing by the total number of 
counts in a normalization window (here, the last 30 nucleotides of the portion 
of coding region shown)

3. Aligning each vector at the feature of interest (the start codon)

4. Taking an average (e.g. a median, mean, or percentile) over all of the normalized 
vectors at each aligned nucleotide position. Typically, we use the median

Determine P-site offsets for ribosome profiling data - https://plastid.readthedocs.org/en/latest/examples/p_site.html#determine-p-site-offsets-for-ribosome-profiling-data
Read phasing in ribosome profiling - https://plastid.readthedocs.org/en/latest/examples/phasing.html

/////////////////////////
Scripts:

* prune_transcripts.py

"Use ribosome profiling data to remove unwanted transcripts from a
transcriptome. Transcripts will be removed if they do not have enough reads of
the desired length, if they have greater than some fraction of their reads
from a single position, if they are annotated as pseudogenes (and multimap
with another transcript), or if they have more multimapping reads beyond what
would be expected based on the number of multimapping positions. It is
recommended that this file be run in an empty directory and that OUTBED remain
at the default value ("transcripts.bed") for consistency with later scripts."

transcriptome-aligned BAM file(s), Ideally, should be ribosome profiling data 
sets collected in the absence of initiation inhibitors (e.g. CHX or no drug)

fpsize = opts.minlen # fixed 29-nt
psite = (fpsize + 1) / 2

get transcript info/summary:  {'chrom': chrom, 'strand': strand, 'n_psite': -1, 'n_reads': -1, 'peak_reads': -1, 'dropped': ''}
find multimapping: to a different genomic position
dropped transcripts: lower_reads, peakfrac, pseudofrac, multi

* make_tfams.py

"Identify overlapping transcripts from a bed file, termed transcript families
("tfams"). Each tfam will be assigned a name, either based on the transcript
IDs or from an optional gene name file. It is recommended that this script be
run in a newly created folder containing only the input BED file, generated by
prune_transcripts.py, and possibly the GENENAMES file. It is also recommended
that the default value ("tfams") be used for parameter TFAMSTEM, for
consistency with later scripts."

transcripts generated by prune_transcripts.py

OUTSTEM.txt will be a tab-delimited file indicating which transcripts are in which tfam

tfams = {}  # will contain integer keys to a tuple: ([list of tid],(chrom,strand),{set of gcoord})

* psite_trimmed.py

"Find most common P-site offset for each read length in a ribosome profiling
experiment. If multiple ribosome profiling datasets are to be analyzed
separately (e.g. if they were collected under different drug treatments), then
this program should be run separately for each, ideally in separate subfolders
indicated by SUBDIR."

Needs start codon pos (--cdsbed)

Is it similar to plastid psite script?

* find_orfs_and_types.py

"Identify all possible ORFs in a transcriptome. ORF-RATER will evaluate translation 
of only these ORFs." 

Default start codon "ATG", can be "NTG"

genome is required as input in order to extract seqence

_find_all_orfs(myseq): Identify ORFs, or at least starts. Returns list of (start, stop, codon)
_identify_tfam_orfs((tfam, tids)): Identify all of the possible ORFs within a family of transcripts

Types:
ANNOTATED and XISO (exact isoform)
SISO (spliced isoform)
CISO (C-terminal isoform)
TRUNCATION
EXTENSION
NISO (N-terminal isoform)
NCISO (N- and C-terminal isoform)
INTERNAL
STOP_OVERLAP
START_OVERLAP
LOOF (long out-of-frame)
UPSTREAM
DOWNSTREAM
NEW_ISO and GISO (genomic isoform)

* regress_orfs.py

"Use linear regression to identify likely sites of translation. Regression will
be performed for ORFs defined by find_orfs_and_types.py using a metagene
profile constructed from annotated CDSs. If multiple ribosome profiling
datasets are to be analyzed separately (e.g. if they were collected under
different drug treatments), then this program should be run separately for
each, ideally in separate subfolders indicated by SUBDIR."

psite offset profile generated by psite_trimmed.py
_get_annotated_counts_by_chrom()： Accumulate counts from annotated CDSs into a metagene profile

_orf_profile(): Generate a profile for an ORF based on the metagene profile

_regress_tfam(): Performs non-negative least squares regression on all of the ORFs in a transcript 
family, using profiles constructed via _orf_profile(). Also calculates Wald statistics for each 
orf and start codon, and for each stop codon if opts.startonly is False

(orf_strs, resid) = nnls(orf_matrix.toarray(), counts)

* rate_regression_output.py

"Combine one or more output files from regress_orfs.py into a final translation
rating for each ORF. Features will be loaded and calculated from the
regression output, and scores will be calculated using a random forest,
followed by a monotonization procedure to remove some overfitting artifacts."

length of ORFs >= than 100 aa
parser.add_argument('--goldminlen', type=int, default=100, help='Minimum length (in codons) for ORFs included in the training set (Default: 100)')

Random forest are a bunch of decision trees with random subset of the whole data for each tree.
Features:


* make_orf_bed.py
* quantify_orfs.py


ORFscore
----------

Key:
1. triplet periodicity (or sub-codon phasing) is a unique property of actively translating ribosomes.
   The discete movement along the message in three-nucleotide steps. Since phased ribosome binding 
   is a direct consequence of active translation. Using it as a criterion would reduce the noise in
   conventional ribosome profiling analyses and identify smORFs undergoing translation in vivo.

2. The periodic distribution of RPFs should derive from a biased in-frame distribution of RPFs 
   toward the first frame of a given CDS. This pattern could be used to define actively translated 
   regions and distinguish them from background signal.

3. Defining ORFs: Using the spliced version of each transcript, all possible stop codonsin each of 
   the three reading frames were defined. Each stop codon was paired with the most distal in-frame 
   AUG codon without an intervening stop. Each region from most distal AUG to stop was thus defined 
   as an ORF. 

4. Algorithm: ORFscore quantifies the biased distribution of RPFs toward the first frame of a given CDS. 
   Given a putative ORF in the transcriptome (AUG to stop), we quantified the number of RPFs in each 
   frame and determined whether RPFs were uniformly distributed or preferentially accumulated in one frame. 
   We assigned a negative value to RPF distributions inconsistent with the frame of the ORF.

Limitations:
Distal AUG-stop

SPECtre
----------
https://github.com/mills-lab/spectre

Designed to identify regions of active translation from ribosome profiling sequence data. This 
analytical pipeline scores the translational status of each annotated region (5'UTR, CDS, exon, 
3'UTR) as a function of its spectral coherence over user-defined N nucleotide sliding windows 
to an idealized reference coding signal.

http://www.ccmb.med.umich.edu/node/1482

FLOSS implementation: class FLOSS(object)
ORFscore implementation: class ORF(object) and psite_frame_reads(self)

ORF periodicity score
----------
By Juan Mata

Key:

1. 

2. 

RiboTaper
----------
